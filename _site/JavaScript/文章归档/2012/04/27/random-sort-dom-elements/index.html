
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>JavaScript随机排序的一种实现</title>
    
    <meta name="author" content="Name Lastname">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">Jekyll Bootstrap</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
  
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header">
  <h1>JavaScript随机排序的一种实现 <small>Supporting tagline</small></h1>
</div>

<div class="row">
  <div class="span8">
    <p>开发中经常会用到的dom元素随机排序的一种实现方式，并附有简单例子，代码有注释，很容易懂的。</p>

<p>DEMO截图：</p>

<p><a href='http://44ux.com/demo/random-sort.html'><img alt='Screenshot' src='http://44ux.com/demo/random-sort.html' /></a></p>

<pre><code>&lt;h1&gt;Random Card&lt;/h1&gt;
&lt;ul id=&quot;container&quot;&gt;
    &lt;li class=&quot;pk&quot; style=&quot;background:red;&quot;&gt;Red&lt;/li&gt;
    &lt;li class=&quot;pk&quot; style=&quot;background:green;&quot;&gt;Green&lt;/li&gt;
    &lt;li class=&quot;pk&quot; style=&quot;background:pink;&quot;&gt;Pink&lt;/li&gt;
    &lt;li class=&quot;pk&quot; style=&quot;background:purple;&quot;&gt;Purple&lt;/li&gt;
    &lt;li class=&quot;pk&quot; style=&quot;background:blue;&quot;&gt;Blue&lt;/li&gt;
    &lt;li class=&quot;pk&quot; style=&quot;background:orange;&quot;&gt;Orange&lt;/li&gt;
&lt;/ul&gt;

&lt;button id=&quot;shuffle&quot;&gt;开始随机洗牌&lt;/button&gt;

function shuffle(){
    // 获取列表项
    var temp = document.getElementsByTagName(&#39;li&#39;);

    // 创建新数组用来保存列表项
    var list = new Array();

    // 为每个列表项分配一个随机数属性，并将其存入新数组
    for(var i=0, j=temp.length; i&lt;j; i++){
        temp[i].order = Math.random();
        list.push(temp[i]);
    }

    // 对新数组按其随机数属性进行排序
    list = list.sort(function(a,b){
        return a.order - b.order;
    });

    var container = document.getElementById(&#39;container&#39;);
    container.style.display = &#39;none&#39;; // offline
    container.innerHTML = &#39;&#39;;

    for(; list.length&gt;0; ){
        container.appendChild(list.pop());
    }

    container.style.display = &#39;block&#39;;
}

document.getElementById(&#39;shuffle&#39;).onclick = function(){
    shuffle();
};</code></pre>

<p><a href='http://44ux.com/demo/random-sort.html'>点击这里查看DEMO</a></p>

<p>补充1：经wikixie同学提醒，随机的代码也可改为：</p>

<pre><code>list = list.sort(function(a,b){
        return Math.random() - Math.random();
});</code></pre>

<p>补充2：经<a href='http://yekai.net'>猫哥</a>提醒，补充1所示代码有可能导致概率不等。具体原因为：各个浏览器对sort()方法实现方式不同，使用两次随机差值进行比较，可能导致各项机会不均等。具体大家可以深入了解JavaScript中sort()的底层实现方式。</p>

<p>这里是<a href='http://svn.webkit.org/repository/webkit/trunk/Source/JavaScriptCore/runtime/ArrayPrototype.cpp'>WebKit源码</a>中的实现方式，有兴趣同学可以研究一下：</p>

<pre><code>// &quot;Min&quot; sort. Not the fastest, but definitely less code than heapsort
    // or quicksort, and much less swapping than bubblesort/insertionsort.
    for (unsigned i = 0; i &lt; length - 1; ++i) {
        JSValue iObj = thisObj-&gt;get(exec, i);
        if (exec-&gt;hadException())
            return JSValue::encode(jsUndefined());
        unsigned themin = i;
        JSValue minObj = iObj;
        for (unsigned j = i + 1; j &lt; length; ++j) {
            JSValue jObj = thisObj-&gt;get(exec, j);
            if (exec-&gt;hadException())
                return JSValue::encode(jsUndefined());
            double compareResult;
            if (jObj.isUndefined())
                compareResult = 1; // don&#39;t check minObj because there&#39;s no need to differentiate == (0) from &gt; (1)
            else if (minObj.isUndefined())
                compareResult = -1;
            else if (callType != CallTypeNone) {
                MarkedArgumentBuffer l;
                l.append(jObj);
                l.append(minObj);
                compareResult = call(exec, function, callType, callData, jsUndefined(), l).toNumber(exec);
            } else
                compareResult = (jObj.toUStringInline(exec) &lt; minObj.toUStringInline(exec)) ? -1 : 1;

            if (compareResult &lt; 0) {
                themin = j;
                minObj = jObj;
            }
        }
        // Swap themin and i
        if (themin &gt; i) {
            thisObj-&gt;methodTable()-&gt;putByIndex(thisObj, exec, i, minObj, true);
            if (exec-&gt;hadException())
                return JSValue::encode(jsUndefined());
            thisObj-&gt;methodTable()-&gt;putByIndex(thisObj, exec, themin, iObj, true);
            if (exec-&gt;hadException())
                return JSValue::encode(jsUndefined());
        }
    }</code></pre>

<p><span />: http://44ux.com/demo/random-sort.html</p>
    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/Html+CSS/开发工具/文章归档/2012/04/27/code-cleaner-chrome-extention" title="代码复用工具 Code Cleaner Chrome 扩展版
">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/Html+CSS/奇技淫巧/文章归档/2012/05/03/high-efficient-css-technical" title="高效CSS开发核心要点">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jekyllbootstrap'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>27 April 2012</span></div>

    
  </div>
</div>


      </div>

      <footer>
        <p>&copy; Name Lastname 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->

    
  </body>
</html>

